# Produce datacards with the proper differential variable
# add the variable you want to measure in mca-includes/mca-2lss-sigprompt.txt. Add one process per gen-level bin
# Do not forget to add out-of-acceptance signal as well! This is signal that doesnt pass our fiducial selection but somehow makes it to our signal region
# For the commands below we'll assume we want to measure lep1_pt 
# Add this variable to availableObservables in make_cards_new . There you also set which reco-level bins you are using.

# Then produce the cards
for year in 2016 2016APV 2017 2018; do python ttW_multilepton/make_cards_new.py outputname ${year} 2lss lep1_pt | bash; done
# Produce also the card with the gen distribution
for year in 2016 2016APV 2017 2018; do python ttW_multilepton/make_cards_new.py outputname ${year} 2lss lep1_pt gen | bash; done

=========================================================================================================================

#Run the fitter: 
makeDifferentialFits.py folder_to_cards var fitting_step
steps:
0 combine cards
1 make workspace
2 do fitting

# that gives you the signal strength for each bin of the differential distribution.
=========================================================================================================================
Do plots, matrix...
 Then you have to convert that to an absolute cross section. In practice you can do it by 
# 1) getting the gen level distribution. For that you need an unskimmed sample
# 2) scale each of the bins of the gen level distribution by the mu you have measured in the fit. Make sure the ttW normalization uncertainty doesnt make it to this result!

ttW_multilepton/makeDifferentialPlot.py folder genDistribution  var
ttW_multilepton/makeDifferentialMatix.py workspace.root fitdiagnostics.root genDistribution.root  varname



# impact plots 
python ttW_multilepton/getImpacts.py --inpath cards/13jul/lep1_pt --variable lep1_pt --verbose -j 10